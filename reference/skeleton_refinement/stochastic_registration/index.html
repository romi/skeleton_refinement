
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Skeleton refinement documentation.">
      
      
        <meta name="author" content="ROMI Team">
      
      
        <link rel="canonical" href="https://romi.github.io/skeleton_refinement/reference/skeleton_refinement/stochastic_registration/">
      
      
        <link rel="prev" href="../io/">
      
      
        <link rel="next" href="../utilities/">
      
      
      <link rel="icon" href="../../../assets/images/ROMI_ICON_green.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.9">
    
    
      
        <title>stochastic_registration - Skeleton refinement</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.4af4bdda.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito+Sans:300,300i,400,400i,700,700i%7CUbuntu+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Nunito Sans";--md-code-font:"Ubuntu Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_markdown_exec_pyodide.css">
    
      <link rel="stylesheet" href="../../../assets/_markdown_exec_ansi.css">
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../assets/css/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#skeleton_refinement.stochastic_registration" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://romi.github.io/skeleton_refinement/" title="Skeleton refinement" class="md-header__button md-logo" aria-label="Skeleton refinement" data-md-component="logo">
      
  <img src="../../../assets/images/ROMI_logo_white.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Skeleton refinement
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              stochastic_registration
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/romi/skeleton_refinement" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  Reference API

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../dev/" class="md-tabs__link">
        
  
    
  
  Developers &amp; contributors

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://romi.github.io/skeleton_refinement/" title="Skeleton refinement" class="md-nav__button md-logo" aria-label="Skeleton refinement" data-md-component="logo">
      
  <img src="../../../assets/images/ROMI_logo_white.svg" alt="logo">

    </a>
    Skeleton refinement
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/romi/skeleton_refinement" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Reference API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Reference API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    skeleton_refinement
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            skeleton_refinement
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../cli/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    cli
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_1_1" id="__nav_2_1_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_1">
            <span class="md-nav__icon md-icon"></span>
            cli
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli/refine_skeleton/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    refine_skeleton
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deformable_registration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    deformable_registration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../expectation_maximization_registration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    expectation_maximization_registration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../io/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    io
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    stochastic_registration
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    stochastic_registration
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#skeleton_refinement.stochastic_registration" class="md-nav__link">
    <span class="md-ellipsis">
      stochastic_registration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skeleton_refinement.stochastic_registration--load-point-cloud-and-skeleton-data" class="md-nav__link">
    <span class="md-ellipsis">
      Load point cloud and skeleton data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skeleton_refinement.stochastic_registration--perform-registration-to-align-skeleton-with-point-cloud" class="md-nav__link">
    <span class="md-ellipsis">
      Perform registration to align skeleton with point cloud
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skeleton_refinement.stochastic_registration--generate-skeleton-graph-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Generate skeleton graph structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skeleton_refinement.stochastic_registration.knn_mst" class="md-nav__link">
    <span class="md-ellipsis">
      knn_mst
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skeleton_refinement.stochastic_registration.perform_registration" class="md-nav__link">
    <span class="md-ellipsis">
      perform_registration
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utilities/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    utilities
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dev/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Developers &amp; contributors
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#skeleton_refinement.stochastic_registration" class="md-nav__link">
    <span class="md-ellipsis">
      stochastic_registration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skeleton_refinement.stochastic_registration--load-point-cloud-and-skeleton-data" class="md-nav__link">
    <span class="md-ellipsis">
      Load point cloud and skeleton data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skeleton_refinement.stochastic_registration--perform-registration-to-align-skeleton-with-point-cloud" class="md-nav__link">
    <span class="md-ellipsis">
      Perform registration to align skeleton with point cloud
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skeleton_refinement.stochastic_registration--generate-skeleton-graph-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Generate skeleton graph structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skeleton_refinement.stochastic_registration.knn_mst" class="md-nav__link">
    <span class="md-ellipsis">
      knn_mst
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skeleton_refinement.stochastic_registration.perform_registration" class="md-nav__link">
    <span class="md-ellipsis">
      perform_registration
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>stochastic_registration</h1>

<div class="doc doc-object doc-module">



<a id="skeleton_refinement.stochastic_registration"></a>
    <div class="doc doc-contents first">

        <p>Stochastic Point Cloud Registration</p>
<p>A module for aligning and registering 3D skeleton structures to point clouds using stochastic optimization techniques.
It enables precise fitting of skeletal models to noisy or dense point cloud data, commonly used in 3D plant structure analysis.</p>


<details class="key-features" open>
  <summary>Key Features</summary>
  <ul>
<li>Non-rigid point set registration using Coherent Point Drift (CPD) algorithm</li>
<li>Optimized skeleton alignment to underlying point cloud structures</li>
<li>Minimum spanning tree construction from point sets using k-nearest neighbors</li>
<li>Configurable regularization parameters for controlling deformation smoothness</li>
<li>Support for handling outliers and varying point densities</li>
</ul>
</details>

<details class="usage-examples" open>
  <summary>Usage Examples</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>from skeleton_refinement.stochastic_registration import perform_registration, knn_mst
from skeleton_refinement.io import load_ply, load_json</p>
<h2 id="skeleton_refinement.stochastic_registration--load-point-cloud-and-skeleton-data">Load point cloud and skeleton data<a class="headerlink" href="#skeleton_refinement.stochastic_registration--load-point-cloud-and-skeleton-data" title="Permanent link">Link</a></h2>
<p>pcd = load_ply("path/to/pointcloud.ply")
skel = load_json("path/to/skeleton.json", "points")</p>
<h2 id="skeleton_refinement.stochastic_registration--perform-registration-to-align-skeleton-with-point-cloud">Perform registration to align skeleton with point cloud<a class="headerlink" href="#skeleton_refinement.stochastic_registration--perform-registration-to-align-skeleton-with-point-cloud" title="Permanent link">Link</a></h2>
<p>refined_skel = perform_registration(pcd, skel, alpha=5, beta=5)</p>
<h2 id="skeleton_refinement.stochastic_registration--generate-skeleton-graph-structure">Generate skeleton graph structure<a class="headerlink" href="#skeleton_refinement.stochastic_registration--generate-skeleton-graph-structure" title="Permanent link">Link</a></h2>
<p>skel_tree = knn_mst(refined_skel)</p>
</blockquote>
</blockquote>
</blockquote>
</details>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="skeleton_refinement.stochastic_registration.knn_mst" class="doc doc-heading">
            <code class="highlight language-python">knn_mst(skeleton_points, n_neighbors<span style="color: #666">=5</span>, knn_algorithm<span style="color: #666">=</span><span style="color: #BA2121">&#39;kd_tree&#39;</span>, mst_algorithm<span style="color: #666">=</span><span style="color: #BA2121">&#39;kruskal&#39;</span>)</code>

<a href="#skeleton_refinement.stochastic_registration.knn_mst" class="headerlink" title="Permanent link">Link</a></h2>


    <div class="doc doc-contents ">

        <p>Create a minimum spanning tree from skeleton points using k-nearest neighbors graph.</p>
<p>This function constructs a k-nearest neighbors graph from the input skeleton points
using Euclidean distances, then computes the minimum spanning tree of this graph.
The resulting tree represents the skeleton structure as a connected graph with
minimal total edge weight.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>skeleton_points</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The skeleton coordinates of shape <code>(n_points, 3)</code>, with XYZ coordinates.
Each row represents the 3D position of a skeleton point.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_neighbors</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of neighbors to consider for each point when building the
k-nearest neighbors graph. Default is <code>5</code>.</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>knn_algorithm</code>
            </td>
            <td>
                  <code>(<span title="auto">auto</span>, <span title="ball_tree">ball_tree</span>, <span title="kd_tree">kd_tree</span>, <span title="brute">brute</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The algorithm to use for computing the k-nearest neighbors.
- 'kd_tree': KD Tree algorithm, works well for low dimensions.
- 'ball_tree': Ball Tree algorithm, works well for high dimensions.
- 'brute': Brute force algorithm, always uses all data points.
- 'auto': Automatically chooses the most appropriate algorithm.
Default is <code>'kd_tree'</code>.</p>
              </div>
            </td>
            <td>
                  <code>&#39;auto&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mst_algorithm</code>
            </td>
            <td>
                  <code>(<span title="kruskal">kruskal</span>, <span title="prim">prim</span>, <span title="boruvka">boruvka</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The algorithm to use for computing the minimum spanning tree.
- 'kruskal': Kruskal's algorithm, efficient for sparse graphs.
- 'prim': Prim's algorithm, efficient for dense graphs.
- 'boruvka': Borůvka's algorithm, another MST algorithm.
Default is <code>'kruskal'</code>.</p>
              </div>
            </td>
            <td>
                  <code>&#39;kruskal&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="networkx.Graph">Graph</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A NetworkX Graph representing the skeleton structure as a minimum spanning tree.
- Nodes correspond to skeleton points with their 3D coordinates stored as a 'position' attribute
- Edges connect points that are part of the minimum spanning tree
- Edge weights represent Euclidean distances between connected points</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>The function first builds a k-nearest neighbors graph where each point is connected
to its k nearest neighbors. Then it computes the minimum spanning tree of this graph
to create a connected structure with minimal total edge length.</p>
<p>The Minkowski distance with <code>p=2</code> is used, which corresponds to the Euclidean distance.</p>
</details>

<details class="see-also" open>
  <summary>See Also</summary>
  <p>sklearn.neighbors.NearestNeighbors : For finding nearest neighbors
networkx.minimum_spanning_tree : For computing minimum spanning trees</p>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="language-pycon highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #000080; font-weight: bold">&gt;&gt;&gt; </span><span style="color: #008000; font-weight: bold">from</span><span style="color: #BBB"> </span><span style="color: #00F; font-weight: bold">skeleton_refinement.stochastic_registration</span><span style="color: #BBB"> </span><span style="color: #008000; font-weight: bold">import</span> perform_registration
<span style="color: #000080; font-weight: bold">&gt;&gt;&gt; </span><span style="color: #008000; font-weight: bold">from</span><span style="color: #BBB"> </span><span style="color: #00F; font-weight: bold">skeleton_refinement.stochastic_registration</span><span style="color: #BBB"> </span><span style="color: #008000; font-weight: bold">import</span> knn_mst
<span style="color: #000080; font-weight: bold">&gt;&gt;&gt; </span><span style="color: #008000; font-weight: bold">from</span><span style="color: #BBB"> </span><span style="color: #00F; font-weight: bold">skeleton_refinement.io</span><span style="color: #BBB"> </span><span style="color: #008000; font-weight: bold">import</span> load_ply, load_json
<span style="color: #000080; font-weight: bold">&gt;&gt;&gt; </span>pcd <span style="color: #666">=</span> load_ply(<span style="color: #BA2121">&quot;real_plant_analyzed/PointCloud_1_0_1_0_10_0_7ee836e5a9/PointCloud.ply&quot;</span>)
<span style="color: #000080; font-weight: bold">&gt;&gt;&gt; </span>skel <span style="color: #666">=</span> load_json(<span style="color: #BA2121">&quot;real_plant_analyzed/CurveSkeleton__TriangleMesh_0393cb5708/CurveSkeleton.json&quot;</span>, <span style="color: #BA2121">&quot;points&quot;</span>)
<span style="color: #000080; font-weight: bold">&gt;&gt;&gt; </span><span style="color: #3D7B7B; font-style: italic"># Perform stochastic optimization</span>
<span style="color: #000080; font-weight: bold">&gt;&gt;&gt; </span>refined_skel <span style="color: #666">=</span> perform_registration(pcd, skel, alpha<span style="color: #666">=5</span>, beta<span style="color: #666">=5</span>)
<span style="color: #000080; font-weight: bold">&gt;&gt;&gt; </span><span style="color: #3D7B7B; font-style: italic"># Compute skeleton tree structure using mst on knn-graph:</span>
<span style="color: #000080; font-weight: bold">&gt;&gt;&gt; </span>skel_tree <span style="color: #666">=</span> knn_mst(refined_skel)
<span style="color: #000080; font-weight: bold">&gt;&gt;&gt; </span><span style="color: #3D7B7B; font-style: italic"># The output is a NetworkX Graph with nodes representing skeleton points</span>
<span style="color: #000080; font-weight: bold">&gt;&gt;&gt; </span><span style="color: #008000">print</span>(<span style="color: #BA2121">f&quot;Number of nodes: </span><span style="color: #A45A77; font-weight: bold">{</span>skel_tree<span style="color: #666">.</span>number_of_nodes()<span style="color: #A45A77; font-weight: bold">}</span><span style="color: #BA2121">&quot;</span>)
<span style="color: #000080; font-weight: bold">&gt;&gt;&gt; </span><span style="color: #008000">print</span>(<span style="color: #BA2121">f&quot;Number of edges: </span><span style="color: #A45A77; font-weight: bold">{</span>skel_tree<span style="color: #666">.</span>number_of_edges()<span style="color: #A45A77; font-weight: bold">}</span><span style="color: #BA2121">&quot;</span>)
<span style="color: #000080; font-weight: bold">&gt;&gt;&gt; </span><span style="color: #3D7B7B; font-style: italic"># Access node coordinates</span>
<span style="color: #000080; font-weight: bold">&gt;&gt;&gt; </span>sample_node <span style="color: #666">=</span> <span style="color: #008000">list</span>(skel_tree<span style="color: #666">.</span>nodes())[<span style="color: #666">0</span>]
<span style="color: #000080; font-weight: bold">&gt;&gt;&gt; </span><span style="color: #008000">print</span>(<span style="color: #BA2121">f&quot;Position of node </span><span style="color: #A45A77; font-weight: bold">{</span>sample_node<span style="color: #A45A77; font-weight: bold">}</span><span style="color: #BA2121">: </span><span style="color: #A45A77; font-weight: bold">{</span>skel_tree<span style="color: #666">.</span>nodes[sample_node][<span style="color: #BA2121">&#39;position&#39;</span>]<span style="color: #A45A77; font-weight: bold">}</span><span style="color: #BA2121">&quot;</span>)
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>skeleton_refinement/stochastic_registration.py</code></summary>
              <div class="language-python highlight" style="background: #f8f8f8"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">130</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">131</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">132</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">133</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">134</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">135</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">136</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">137</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">138</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">139</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">140</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">141</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">142</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">143</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">144</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">145</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">146</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">147</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">148</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">149</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">150</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">151</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">152</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">153</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">154</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">155</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">156</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">157</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">158</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">159</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">160</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">161</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">162</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">163</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">164</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">165</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">166</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">167</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">168</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">169</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">170</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">171</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">172</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">173</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">174</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">175</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">176</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">177</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">178</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">179</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">180</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">181</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">182</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">183</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">184</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">185</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">186</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">187</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">188</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">189</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">190</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">191</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">192</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">193</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">194</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">195</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">196</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">197</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">198</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">199</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">200</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">201</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">202</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">203</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">204</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">205</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">206</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">207</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">208</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">209</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">210</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">211</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">212</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">213</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">214</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">215</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">216</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">217</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">218</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">219</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">220</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">221</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">222</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">223</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">224</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">225</span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span><span style="color: #BBB"> </span><span style="color: #00F">knn_mst</span>(skeleton_points, n_neighbors<span style="color: #666">=5</span>, knn_algorithm<span style="color: #666">=</span><span style="color: #BA2121">&#39;kd_tree&#39;</span>, mst_algorithm<span style="color: #666">=</span><span style="color: #BA2121">&#39;kruskal&#39;</span>):
<span style="color: #BBB">    </span><span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Create a minimum spanning tree from skeleton points using k-nearest neighbors graph.</span>

<span style="color: #BA2121; font-style: italic">    This function constructs a k-nearest neighbors graph from the input skeleton points</span>
<span style="color: #BA2121; font-style: italic">    using Euclidean distances, then computes the minimum spanning tree of this graph.</span>
<span style="color: #BA2121; font-style: italic">    The resulting tree represents the skeleton structure as a connected graph with</span>
<span style="color: #BA2121; font-style: italic">    minimal total edge weight.</span>

<span style="color: #BA2121; font-style: italic">    Parameters</span>
<span style="color: #BA2121; font-style: italic">    ----------</span>
<span style="color: #BA2121; font-style: italic">    skeleton_points : numpy.ndarray</span>
<span style="color: #BA2121; font-style: italic">        The skeleton coordinates of shape ``(n_points, 3)``, with XYZ coordinates.</span>
<span style="color: #BA2121; font-style: italic">        Each row represents the 3D position of a skeleton point.</span>
<span style="color: #BA2121; font-style: italic">    n_neighbors : int, optional</span>
<span style="color: #BA2121; font-style: italic">        The number of neighbors to consider for each point when building the</span>
<span style="color: #BA2121; font-style: italic">        k-nearest neighbors graph. Default is ``5``.</span>
<span style="color: #BA2121; font-style: italic">    knn_algorithm : {&#39;auto&#39;, &#39;ball_tree&#39;, &#39;kd_tree&#39;, &#39;brute&#39;}, optional</span>
<span style="color: #BA2121; font-style: italic">        The algorithm to use for computing the k-nearest neighbors.</span>
<span style="color: #BA2121; font-style: italic">        - &#39;kd_tree&#39;: KD Tree algorithm, works well for low dimensions.</span>
<span style="color: #BA2121; font-style: italic">        - &#39;ball_tree&#39;: Ball Tree algorithm, works well for high dimensions.</span>
<span style="color: #BA2121; font-style: italic">        - &#39;brute&#39;: Brute force algorithm, always uses all data points.</span>
<span style="color: #BA2121; font-style: italic">        - &#39;auto&#39;: Automatically chooses the most appropriate algorithm.</span>
<span style="color: #BA2121; font-style: italic">        Default is `&#39;kd_tree&#39;`.</span>
<span style="color: #BA2121; font-style: italic">    mst_algorithm : {&#39;kruskal&#39;, &#39;prim&#39;, &#39;boruvka&#39;}, optional</span>
<span style="color: #BA2121; font-style: italic">        The algorithm to use for computing the minimum spanning tree.</span>
<span style="color: #BA2121; font-style: italic">        - &#39;kruskal&#39;: Kruskal&#39;s algorithm, efficient for sparse graphs.</span>
<span style="color: #BA2121; font-style: italic">        - &#39;prim&#39;: Prim&#39;s algorithm, efficient for dense graphs.</span>
<span style="color: #BA2121; font-style: italic">        - &#39;boruvka&#39;: Borůvka&#39;s algorithm, another MST algorithm.</span>
<span style="color: #BA2121; font-style: italic">        Default is `&#39;kruskal&#39;`.</span>

<span style="color: #BA2121; font-style: italic">    Returns</span>
<span style="color: #BA2121; font-style: italic">    -------</span>
<span style="color: #BA2121; font-style: italic">    networkx.Graph</span>
<span style="color: #BA2121; font-style: italic">        A NetworkX Graph representing the skeleton structure as a minimum spanning tree.</span>
<span style="color: #BA2121; font-style: italic">        - Nodes correspond to skeleton points with their 3D coordinates stored as a &#39;position&#39; attribute</span>
<span style="color: #BA2121; font-style: italic">        - Edges connect points that are part of the minimum spanning tree</span>
<span style="color: #BA2121; font-style: italic">        - Edge weights represent Euclidean distances between connected points</span>

<span style="color: #BA2121; font-style: italic">    Notes</span>
<span style="color: #BA2121; font-style: italic">    -----</span>
<span style="color: #BA2121; font-style: italic">    The function first builds a k-nearest neighbors graph where each point is connected</span>
<span style="color: #BA2121; font-style: italic">    to its k nearest neighbors. Then it computes the minimum spanning tree of this graph</span>
<span style="color: #BA2121; font-style: italic">    to create a connected structure with minimal total edge length.</span>

<span style="color: #BA2121; font-style: italic">    The Minkowski distance with ``p=2`` is used, which corresponds to the Euclidean distance.</span>

<span style="color: #BA2121; font-style: italic">    See Also</span>
<span style="color: #BA2121; font-style: italic">    --------</span>
<span style="color: #BA2121; font-style: italic">    sklearn.neighbors.NearestNeighbors : For finding nearest neighbors</span>
<span style="color: #BA2121; font-style: italic">    networkx.minimum_spanning_tree : For computing minimum spanning trees</span>

<span style="color: #BA2121; font-style: italic">    Examples</span>
<span style="color: #BA2121; font-style: italic">    --------</span>
<span style="color: #BA2121; font-style: italic">    &gt;&gt;&gt; from skeleton_refinement.stochastic_registration import perform_registration</span>
<span style="color: #BA2121; font-style: italic">    &gt;&gt;&gt; from skeleton_refinement.stochastic_registration import knn_mst</span>
<span style="color: #BA2121; font-style: italic">    &gt;&gt;&gt; from skeleton_refinement.io import load_ply, load_json</span>
<span style="color: #BA2121; font-style: italic">    &gt;&gt;&gt; pcd = load_ply(&quot;real_plant_analyzed/PointCloud_1_0_1_0_10_0_7ee836e5a9/PointCloud.ply&quot;)</span>
<span style="color: #BA2121; font-style: italic">    &gt;&gt;&gt; skel = load_json(&quot;real_plant_analyzed/CurveSkeleton__TriangleMesh_0393cb5708/CurveSkeleton.json&quot;, &quot;points&quot;)</span>
<span style="color: #BA2121; font-style: italic">    &gt;&gt;&gt; # Perform stochastic optimization</span>
<span style="color: #BA2121; font-style: italic">    &gt;&gt;&gt; refined_skel = perform_registration(pcd, skel, alpha=5, beta=5)</span>
<span style="color: #BA2121; font-style: italic">    &gt;&gt;&gt; # Compute skeleton tree structure using mst on knn-graph:</span>
<span style="color: #BA2121; font-style: italic">    &gt;&gt;&gt; skel_tree = knn_mst(refined_skel)</span>
<span style="color: #BA2121; font-style: italic">    &gt;&gt;&gt; # The output is a NetworkX Graph with nodes representing skeleton points</span>
<span style="color: #BA2121; font-style: italic">    &gt;&gt;&gt; print(f&quot;Number of nodes: {skel_tree.number_of_nodes()}&quot;)</span>
<span style="color: #BA2121; font-style: italic">    &gt;&gt;&gt; print(f&quot;Number of edges: {skel_tree.number_of_edges()}&quot;)</span>
<span style="color: #BA2121; font-style: italic">    &gt;&gt;&gt; # Access node coordinates</span>
<span style="color: #BA2121; font-style: italic">    &gt;&gt;&gt; sample_node = list(skel_tree.nodes())[0]</span>
<span style="color: #BA2121; font-style: italic">    &gt;&gt;&gt; print(f&quot;Position of node {sample_node}: {skel_tree.nodes[sample_node][&#39;position&#39;]}&quot;)</span>
<span style="color: #BA2121; font-style: italic">    &quot;&quot;&quot;</span>
    <span style="color: #3D7B7B; font-style: italic"># Initialize nearest neighbors model with Euclidean distance (Minkowski p=2)</span>
    nbrs <span style="color: #666">=</span> NearestNeighbors(n_neighbors<span style="color: #666">=</span>n_neighbors, algorithm<span style="color: #666">=</span>knn_algorithm, metric<span style="color: #666">=</span><span style="color: #BA2121">&quot;minkowski&quot;</span>, p<span style="color: #666">=2</span>)<span style="color: #666">.</span>fit(
        skeleton_points)
    <span style="color: #3D7B7B; font-style: italic"># Find k-nearest neighbors for each point - returns distances and indices matrices</span>
    distances, indices <span style="color: #666">=</span> nbrs<span style="color: #666">.</span>kneighbors(skeleton_points)

    <span style="color: #3D7B7B; font-style: italic"># Initialize empty undirected graph to build KNN representation</span>
    G <span style="color: #666">=</span> nx<span style="color: #666">.</span>Graph()

    <span style="color: #3D7B7B; font-style: italic"># Add edges between each point and its k-nearest neighbors</span>
    <span style="color: #008000; font-weight: bold">for</span> row, nodes_idx <span style="color: #A2F; font-weight: bold">in</span> <span style="color: #008000">enumerate</span>(indices):
        nodes_idx <span style="color: #666">=</span> <span style="color: #008000">list</span>(<span style="color: #008000">map</span>(<span style="color: #008000">int</span>, nodes_idx))
        node_idx, nei_idx <span style="color: #666">=</span> nodes_idx[<span style="color: #666">0</span>], nodes_idx[<span style="color: #666">1</span>:]  <span style="color: #3D7B7B; font-style: italic"># First index is the point itself</span>
        <span style="color: #3D7B7B; font-style: italic"># Add edges with Euclidean distances as weights</span>
        <span style="color: #3D7B7B; font-style: italic"># Skip first neighbor (index 0) as it&#39;s the point itself</span>
        [G<span style="color: #666">.</span>add_edges_from([(node_idx, n_idx, {<span style="color: #BA2121">&quot;weight&quot;</span>: distances[row, col <span style="color: #666">+</span> <span style="color: #666">1</span>]})]) <span style="color: #008000; font-weight: bold">for</span> col, n_idx <span style="color: #A2F; font-weight: bold">in</span>
         <span style="color: #008000">enumerate</span>(nei_idx)]

    <span style="color: #3D7B7B; font-style: italic"># Store original 3D coordinates as node attributes</span>
    <span style="color: #008000; font-weight: bold">for</span> node_id <span style="color: #A2F; font-weight: bold">in</span> G<span style="color: #666">.</span>nodes:
        G<span style="color: #666">.</span>nodes[node_id][<span style="color: #BA2121">&#39;position&#39;</span>] <span style="color: #666">=</span> skeleton_points[node_id]

    <span style="color: #3D7B7B; font-style: italic"># Compute minimum spanning tree from the KNN graph</span>
    <span style="color: #3D7B7B; font-style: italic"># This creates optimal connected structure with minimal total edge length</span>
    T <span style="color: #666">=</span> nx<span style="color: #666">.</span>minimum_spanning_tree(G, algorithm<span style="color: #666">=</span>mst_algorithm)

    <span style="color: #008000; font-weight: bold">return</span> T
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="skeleton_refinement.stochastic_registration.perform_registration" class="doc doc-heading">
            <code class="highlight language-python">perform_registration(X, Y, <span style="color: #666">**</span>kwargs)</code>

<a href="#skeleton_refinement.stochastic_registration.perform_registration" class="headerlink" title="Permanent link">Link</a></h2>


    <div class="doc doc-contents ">

        <p>Performs stochastic deformation registration to align a skeleton to a point cloud.</p>
<p>This function uses the Coherent Point Drift (CPD) algorithm to perform non-rigid
registration between a reference point cloud and a skeleton. The algorithm optimizes
the skeleton's position to better align with the underlying point cloud structure.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>X</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input reference point cloud coordinates of shape <code>(n_points, dim)</code>, XYZ sorted.
This represents the fixed point set that the skeleton will be aligned to.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>Y</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input reference skeleton coordinates of shape <code>(n_points, dim)</code>, XYZ sorted.
This represents the moving point set that will be transformed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Other Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>alpha</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Regularization weight that controls the smoothness of deformation.
Higher values result in smoother, more rigid transformations.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>beta</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Width of the Gaussian kernel used in the non-rigid transformation.
Controls the influence range of each point in the deformation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>sigma2</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a> or <a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial variance of the Gaussian Mixture Model.
If None, it will be estimated automatically from the point sets.
Defaults to <code>None</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_iterations</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum number of iterations before stopping the iterative registration.
Defaults to <code>100</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>tolerance</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Convergence criterion. The algorithm stops when the error falls below this value.
Defaults to <code>0.001</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>w</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Weight of the uniform distribution in the mixture model.
Used to account for outliers. Value between 0 and 1.
Defaults to <code>0</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The transformed skeleton coordinates of shape <code>(n_points, dim)</code>, XYZ sorted.
This is the optimized skeleton aligned to the input point cloud.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>The function internally uses the DeformableRegistration class which implements
the Coherent Point Drift algorithm. The registration process involves an
Expectation-Maximization approach to optimize the transformation parameters.</p>
<p>The parameters alpha and beta are crucial for obtaining good results:
- Higher alpha values enforce more rigidity in the transformation
- Beta determines the spatial extent of interaction between points</p>
</details>

<details class="see-also" open>
  <summary>See Also</summary>
  <p>skeleton_refinement.deformable_registration.DeformableRegistration : Class that implements the CPD algorithm.
skeleton_refinement.expectation_maximization_registration.ExpectationMaximizationRegistration : Base class for EM-based registration.</p>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="language-pycon highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #000080; font-weight: bold">&gt;&gt;&gt; </span><span style="color: #008000; font-weight: bold">from</span><span style="color: #BBB"> </span><span style="color: #00F; font-weight: bold">skeleton_refinement.stochastic_registration</span><span style="color: #BBB"> </span><span style="color: #008000; font-weight: bold">import</span> perform_registration
<span style="color: #000080; font-weight: bold">&gt;&gt;&gt; </span><span style="color: #008000; font-weight: bold">from</span><span style="color: #BBB"> </span><span style="color: #00F; font-weight: bold">skeleton_refinement.io</span><span style="color: #BBB"> </span><span style="color: #008000; font-weight: bold">import</span> load_ply, load_json
<span style="color: #000080; font-weight: bold">&gt;&gt;&gt; </span>pcd <span style="color: #666">=</span> load_ply(<span style="color: #BA2121">&quot;real_plant_analyzed/PointCloud_1_0_1_0_10_0_7ee836e5a9/PointCloud.ply&quot;</span>)
<span style="color: #000080; font-weight: bold">&gt;&gt;&gt; </span>skel <span style="color: #666">=</span> load_json(<span style="color: #BA2121">&quot;real_plant_analyzed/CurveSkeleton__TriangleMesh_0393cb5708/CurveSkeleton.json&quot;</span>, <span style="color: #BA2121">&quot;points&quot;</span>)
<span style="color: #000080; font-weight: bold">&gt;&gt;&gt; </span><span style="color: #3D7B7B; font-style: italic"># Perform stochastic optimization</span>
<span style="color: #000080; font-weight: bold">&gt;&gt;&gt; </span>refined_skel <span style="color: #666">=</span> perform_registration(pcd, skel, alpha<span style="color: #666">=5</span>, beta<span style="color: #666">=5</span>)
<span style="color: #000080; font-weight: bold">&gt;&gt;&gt; </span><span style="color: #008000">print</span>(refined_skel<span style="color: #666">.</span>shape)
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>skeleton_refinement/stochastic_registration.py</code></summary>
              <div class="language-python highlight" style="background: #f8f8f8"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 38</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 39</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 40</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 41</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 42</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 43</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 44</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 45</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 46</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 47</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 48</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 49</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 50</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 51</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 52</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 53</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 54</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 55</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 56</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 57</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 58</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 59</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 60</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 61</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 62</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 63</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 64</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 65</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 66</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 67</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 68</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 69</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 70</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 71</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 72</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 73</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 74</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 75</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 76</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 77</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 78</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 79</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 80</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 81</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 82</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 83</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 84</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 85</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 86</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 87</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 88</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 89</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 90</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 91</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 92</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 93</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 94</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 95</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 96</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 97</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 98</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 99</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">100</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">101</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">102</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">103</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">104</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">105</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">106</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">107</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">108</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">109</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">110</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">111</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">112</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">113</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">114</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">115</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">116</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">117</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">118</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">119</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">120</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">121</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">122</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">123</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">124</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">125</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">126</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">127</span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span><span style="color: #BBB"> </span><span style="color: #00F">perform_registration</span>(X, Y, <span style="color: #666">**</span>kwargs):
<span style="color: #BBB">    </span><span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Performs stochastic deformation registration to align a skeleton to a point cloud.</span>

<span style="color: #BA2121; font-style: italic">    This function uses the Coherent Point Drift (CPD) algorithm to perform non-rigid</span>
<span style="color: #BA2121; font-style: italic">    registration between a reference point cloud and a skeleton. The algorithm optimizes</span>
<span style="color: #BA2121; font-style: italic">    the skeleton&#39;s position to better align with the underlying point cloud structure.</span>

<span style="color: #BA2121; font-style: italic">    Parameters</span>
<span style="color: #BA2121; font-style: italic">    ----------</span>
<span style="color: #BA2121; font-style: italic">    X : numpy.ndarray</span>
<span style="color: #BA2121; font-style: italic">        The input reference point cloud coordinates of shape `(n_points, dim)`, XYZ sorted.</span>
<span style="color: #BA2121; font-style: italic">        This represents the fixed point set that the skeleton will be aligned to.</span>
<span style="color: #BA2121; font-style: italic">    Y : numpy.ndarray</span>
<span style="color: #BA2121; font-style: italic">        The input reference skeleton coordinates of shape `(n_points, dim)`, XYZ sorted.</span>
<span style="color: #BA2121; font-style: italic">        This represents the moving point set that will be transformed.</span>

<span style="color: #BA2121; font-style: italic">    Other Parameters</span>
<span style="color: #BA2121; font-style: italic">    ----------------</span>
<span style="color: #BA2121; font-style: italic">    alpha : float</span>
<span style="color: #BA2121; font-style: italic">        Regularization weight that controls the smoothness of deformation.</span>
<span style="color: #BA2121; font-style: italic">        Higher values result in smoother, more rigid transformations.</span>
<span style="color: #BA2121; font-style: italic">    beta : float</span>
<span style="color: #BA2121; font-style: italic">        Width of the Gaussian kernel used in the non-rigid transformation.</span>
<span style="color: #BA2121; font-style: italic">        Controls the influence range of each point in the deformation.</span>
<span style="color: #BA2121; font-style: italic">    sigma2 : float or numpy.ndarray, optional</span>
<span style="color: #BA2121; font-style: italic">        Initial variance of the Gaussian Mixture Model.</span>
<span style="color: #BA2121; font-style: italic">        If None, it will be estimated automatically from the point sets.</span>
<span style="color: #BA2121; font-style: italic">        Defaults to ``None``.</span>
<span style="color: #BA2121; font-style: italic">    max_iterations : int, optional</span>
<span style="color: #BA2121; font-style: italic">        The maximum number of iterations before stopping the iterative registration.</span>
<span style="color: #BA2121; font-style: italic">        Defaults to ``100``.</span>
<span style="color: #BA2121; font-style: italic">    tolerance : float, optional</span>
<span style="color: #BA2121; font-style: italic">        Convergence criterion. The algorithm stops when the error falls below this value.</span>
<span style="color: #BA2121; font-style: italic">        Defaults to ``0.001``.</span>
<span style="color: #BA2121; font-style: italic">    w : float, optional</span>
<span style="color: #BA2121; font-style: italic">        Weight of the uniform distribution in the mixture model.</span>
<span style="color: #BA2121; font-style: italic">        Used to account for outliers. Value between 0 and 1.</span>
<span style="color: #BA2121; font-style: italic">        Defaults to ``0``.</span>

<span style="color: #BA2121; font-style: italic">    Returns</span>
<span style="color: #BA2121; font-style: italic">    -------</span>
<span style="color: #BA2121; font-style: italic">    numpy.ndarray</span>
<span style="color: #BA2121; font-style: italic">        The transformed skeleton coordinates of shape `(n_points, dim)`, XYZ sorted.</span>
<span style="color: #BA2121; font-style: italic">        This is the optimized skeleton aligned to the input point cloud.</span>

<span style="color: #BA2121; font-style: italic">    Notes</span>
<span style="color: #BA2121; font-style: italic">    -----</span>
<span style="color: #BA2121; font-style: italic">    The function internally uses the DeformableRegistration class which implements</span>
<span style="color: #BA2121; font-style: italic">    the Coherent Point Drift algorithm. The registration process involves an</span>
<span style="color: #BA2121; font-style: italic">    Expectation-Maximization approach to optimize the transformation parameters.</span>

<span style="color: #BA2121; font-style: italic">    The parameters alpha and beta are crucial for obtaining good results:</span>
<span style="color: #BA2121; font-style: italic">    - Higher alpha values enforce more rigidity in the transformation</span>
<span style="color: #BA2121; font-style: italic">    - Beta determines the spatial extent of interaction between points</span>

<span style="color: #BA2121; font-style: italic">    See Also</span>
<span style="color: #BA2121; font-style: italic">    --------</span>
<span style="color: #BA2121; font-style: italic">    skeleton_refinement.deformable_registration.DeformableRegistration : Class that implements the CPD algorithm.</span>
<span style="color: #BA2121; font-style: italic">    skeleton_refinement.expectation_maximization_registration.ExpectationMaximizationRegistration : Base class for EM-based registration.</span>

<span style="color: #BA2121; font-style: italic">    Examples</span>
<span style="color: #BA2121; font-style: italic">    --------</span>
<span style="color: #BA2121; font-style: italic">    &gt;&gt;&gt; from skeleton_refinement.stochastic_registration import perform_registration</span>
<span style="color: #BA2121; font-style: italic">    &gt;&gt;&gt; from skeleton_refinement.io import load_ply, load_json</span>
<span style="color: #BA2121; font-style: italic">    &gt;&gt;&gt; pcd = load_ply(&quot;real_plant_analyzed/PointCloud_1_0_1_0_10_0_7ee836e5a9/PointCloud.ply&quot;)</span>
<span style="color: #BA2121; font-style: italic">    &gt;&gt;&gt; skel = load_json(&quot;real_plant_analyzed/CurveSkeleton__TriangleMesh_0393cb5708/CurveSkeleton.json&quot;, &quot;points&quot;)</span>
<span style="color: #BA2121; font-style: italic">    &gt;&gt;&gt; # Perform stochastic optimization</span>
<span style="color: #BA2121; font-style: italic">    &gt;&gt;&gt; refined_skel = perform_registration(pcd, skel, alpha=5, beta=5)</span>
<span style="color: #BA2121; font-style: italic">    &gt;&gt;&gt; print(refined_skel.shape)</span>
<span style="color: #BA2121; font-style: italic">    &quot;&quot;&quot;</span>
    <span style="color: #3D7B7B; font-style: italic"># Add input point sets to kwargs to pass to DeformableRegistration</span>
    kwargs<span style="color: #666">.</span>update({<span style="color: #BA2121">&#39;X&#39;</span>: X, <span style="color: #BA2121">&#39;Y&#39;</span>: Y})

    <span style="color: #3D7B7B; font-style: italic"># Initialize the Coherent Point Drift registration object</span>
    reg <span style="color: #666">=</span> DeformableRegistration(<span style="color: #666">**</span>kwargs)
    <span style="color: #3D7B7B; font-style: italic"># Perform initial transformation of the point cloud</span>
    reg<span style="color: #666">.</span>transform_point_cloud()

    <span style="color: #3D7B7B; font-style: italic"># If sigma2 (variance of GMM) is not provided, estimate it and run EM iterations</span>
    <span style="color: #008000; font-weight: bold">if</span> reg<span style="color: #666">.</span>sigma2 <span style="color: #A2F; font-weight: bold">is</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #3D7B7B; font-style: italic"># Initialize sigma2 based on current point sets</span>
        reg<span style="color: #666">.</span>sigma2 <span style="color: #666">=</span> initialize_sigma2(reg<span style="color: #666">.</span>X, reg<span style="color: #666">.</span>TY)
        <span style="color: #3D7B7B; font-style: italic"># Update objective function with new sigma2 value</span>
        <span style="color: #3D7B7B; font-style: italic"># (q is the log-likelihood with regularization terms)</span>
        reg<span style="color: #666">.</span>q <span style="color: #666">=</span> <span style="color: #666">-</span>reg<span style="color: #666">.</span>err <span style="color: #666">-</span> reg<span style="color: #666">.</span>N <span style="color: #666">*</span> reg<span style="color: #666">.</span>D <span style="color: #666">/</span> <span style="color: #666">2</span> <span style="color: #666">*</span> np<span style="color: #666">.</span>log(reg<span style="color: #666">.</span>sigma2)
        <span style="color: #3D7B7B; font-style: italic"># Iteratively refine transformation until convergence or max iterations reached</span>
        <span style="color: #008000; font-weight: bold">while</span> reg<span style="color: #666">.</span>iteration <span style="color: #666">&lt;</span> reg<span style="color: #666">.</span>max_iterations <span style="color: #A2F; font-weight: bold">and</span> reg<span style="color: #666">.</span>err <span style="color: #666">&gt;</span> reg<span style="color: #666">.</span>tolerance:
            reg<span style="color: #666">.</span>iterate()  <span style="color: #3D7B7B; font-style: italic"># Run one EM iteration</span>

    <span style="color: #008000; font-weight: bold">return</span> reg<span style="color: #666">.</span>TY
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      The ROMI project has received funding from the European Community’s H2020 Programme under Grant Agreement No. 773875.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/ROMI_EU_PROJECT" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9zm-24.8 373.8h39.1L151.1 88h-42z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.facebook.com/ROMIEUProject" target="_blank" rel="noopener" title="www.facebook.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M512 256C512 114.6 397.4 0 256 0S0 114.6 0 256c0 120 82.7 220.8 194.2 248.5V334.2h-52.8V256h52.8v-33.7c0-87.1 39.4-127.5 125-127.5 16.2 0 44.2 3.2 55.7 6.4V172c-6-.6-16.5-1-29.6-1-42 0-58.2 15.9-58.2 57.2V256h83.6l-14.4 78.2H287v175.9C413.8 494.8 512 386.9 512 256"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/romi/skeleton_refinement" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="../../../assets/_markdown_exec_pyodide.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
        <script src="https://buttons.github.io/buttons.js"></script>
      
    
  </body>
</html>